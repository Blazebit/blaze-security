<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:my="http://java.sun.com/jsf/composite/components">

<f:view contentType="text/html">
	<h:head>
		<f:facet name="first">
			<meta content='text/html; charset=UTF-8' http-equiv="Content-Type" />
			<title>Carrier</title>
		</f:facet>
		<style>
.top {
	vertical-align: top
}
</style>
	</h:head>

	<h:body>
		<f:event listener="#{carrierBean.init}" type="preRenderComponent" />
		<h:form id="form">
			<h3>
				Logged in as #{userSession.loggedInUser.username} Acting as #{userSession.user.username}. Login as a
				<p:commandLink value="different user..." action="#{userBean.backToIndex()}" process="@this" />
			</h3>



			<h:panelGroup id="subjects">
				Current entity: #{carrierBean.tabEntityClass.name}<br />
				<p:selectOneMenu effect="fade" var="p" style="width:160px" filter="true" filterMatchMode="startsWith"
					valueChangeListener="#{carrierBean.selectSubject}"
					rendered="#{securityBaseBean.isAuthorized('GRANT', carrierBean.tabEntityClass.name) or securityBaseBean.isAuthorized('REVOKE', carrierBean.tabEntityClass.name)}">
					<f:event listener="#{carrierBean.initSubjects}" type="preRenderComponent"/>
					<f:selectItem itemLabel="Select subject" itemValue="" />
					<f:selectItems value="#{carrierBean.subjects}" var="subject" itemLabel="#{subject.name}" itemValue="#{subject.id}"
						itemDescription="#{subject.name}" />
					<p:column>#{p.name}</p:column>
				</p:selectOneMenu>
			</h:panelGroup>




			<p:tabView id="tabs" dynamic="true">
				<p:ajax event="tabChange" listener="#{carrierBean.tabChange}" update=":form:subjects, :form:actions" />
				<p:tab title="Carrier" id="carrierTab">
					<p:commandButton value="New" action="#{carrierBean.newCarrier()}" update=":form:tabs:editCarrier"
						rendered="#{carrierBean.isAuthorized('CREATE', carrierBean.selectedCarrierModel.entity.class.name)}" />
					<br />
					<h:panelGroup id="editCarrier">
						Current entity id: #{carrierBean.selectedCarrierModel.entity.id}<br />
						<my:inputField fieldValue="#{carrierBean.selectedCarrierModel.entity.field1}" fieldLabel="Field1"
							selectedModel="#{carrierBean.selectedCarrierModel}" fieldName="field1"
							fieldModel="#{carrierBean.selectedCarrierModel.fields.get('field1')}" />
						<br />
						<my:inputField fieldValue="#{carrierBean.selectedCarrierModel.entity.field2}" fieldLabel="Field2"
							selectedModel="#{carrierBean.selectedCarrierModel}" fieldName="field2"
							fieldModel="#{carrierBean.selectedCarrierModel.fields.get('field2')}" />
						<br />
						<my:inputField fieldValue="#{carrierBean.selectedCarrierModel.entity.field3}" fieldLabel="Field3"
							selectedModel="#{carrierBean.selectedCarrierModel}" fieldName="field3"
							fieldModel="#{carrierBean.selectedCarrierModel.fields.get('field3')}" />
						<br />
						<my:inputField fieldValue="#{carrierBean.selectedCarrierModel.entity.field4}" fieldLabel="Field4"
							selectedModel="#{carrierBean.selectedCarrierModel}" fieldName="field4"
							fieldModel="#{carrierBean.selectedCarrierModel.fields.get('field4')}" />
						<br />
						<my:inputField fieldValue="#{carrierBean.selectedCarrierModel.entity.field5}" fieldLabel="Field5"
							selectedModel="#{carrierBean.selectedCarrierModel}" fieldName="field5"
							fieldModel="#{carrierBean.selectedCarrierModel.fields.get('field5')}" />
						<br />

						<p:commandButton value="Update" action="#{carrierBean.saveCarrier()}" update=":form:tabs:carriers"
							rendered="#{not empty carrierBean.selectedCarrierModel.entity.id and carrierBean.isAuthorizedResource('UPDATE', carrierBean.selectedCarrierModel.entity)}" />
						<p:commandButton value="Save" action="#{carrierBean.saveNewCarrier()}" update=":form:tabs"
							rendered="#{empty carrierBean.selectedCarrierModel.entity.id and carrierBean.isAuthorized('CREATE', carrierBean.selectedCarrierModel.entity.class.name)}" />
						<br />



						<h:panelGroup id="carriers">
							<p:dataTable value="#{carrierBean.carriers}" var="carrier" rowIndexVar="ind">
								<p:column>
									<f:facet name="header">
										<h:outputText value="Select" />
									</f:facet>
									<h:selectBooleanCheckbox value="#{carrier.selected}"
										rendered="#{carrierBean.isAuthorizedResource('GRANT', carrier.entity)}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="Field 1" />
									</f:facet>
									<h:outputText value="#{carrier.entity.field1}"
										rendered="#{carrierBean.isAuthorizedResource('READ', carrier.entity, 'field1') or carrierBean.isAuthorizedResource('UPDATE', carrier.entity, 'field1')}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="Field 2" />
									</f:facet>
									<h:outputText value="#{carrier.entity.field2}"
										rendered="#{carrierBean.isAuthorizedResource('READ', carrier.entity, 'field2') or carrierBean.isAuthorizedResource('UPDATE', carrier.entity, 'field2')}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="Field 3" />
									</f:facet>
									<h:outputText value="#{carrier.entity.field3}"
										rendered="#{carrierBean.isAuthorizedResource('READ', carrier.entity, 'field3') or carrierBean.isAuthorizedResource('UPDATE', carrier.entity, 'field3')}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="Field 4" />
									</f:facet>
									<h:outputText value="#{carrier.entity.field4}"
										rendered="#{carrierBean.isAuthorizedResource('READ', carrier.entity, 'field4') or carrierBean.isAuthorizedResource('UPDATE', carrier.entity, 'field4')}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="Field 5" />
									</f:facet>
									<h:outputText value="#{carrier.entity.field5}"
										rendered="#{carrierBean.isAuthorizedResource('READ', carrier.entity, 'field5') or carrierBean.isAuthorizedResource('UPDATE', carrier.entity, 'field5')}" />
								</p:column>
								<p:column>
									<p:commandButton value="Select" action="#{carrierBean.selectCarrier(carrier.entity)}" update=":form:tabs" rendered="#{carrierBean.isAuthorizedResource('READ', carrier.entity)}" />
									<p:commandButton value="Delete" action="#{carrierBean.deleteCarrier(carrier.entity)}"
										update=":form:tabs:carriers,:form:tabs:editCarrier"
										rendered="#{carrierBean.isAuthorizedResource('DELETE', carrier.entity)}" />
								</p:column>
							</p:dataTable>
						</h:panelGroup>
					</h:panelGroup>
				</p:tab>

				<p:tab title="Party (one2one)" disabled="#{empty carrierBean.selectedCarrierModel.entity.id}" id="partyTab">
					<h:panelGroup id="editParty">


						<my:inputField fieldValue="#{carrierBean.partyModel.entity.partyField1}" fieldLabel="Field1"
							selectedModel="#{carrierBean.partyModel}" fieldName="partyField1"
							fieldModel="#{carrierBean.partyModel.fields.get('partyField1')}" />
						<br />
						<my:inputField fieldValue="#{carrierBean.partyModel.entity.partyField2}" fieldLabel="Field2"
							selectedModel="#{carrierBean.partyModel}" fieldName="partyField2"
							fieldModel="#{carrierBean.partyModel.fields.get('partyField2')}" />
						<br />
						
						<h:selectBooleanCheckbox value="#{carrierBean.partyModel.selected}"
									rendered="#{carrierBean.isAuthorizedResource('GRANT', carrierBean.partyModel.entity)}" />

						<p:commandButton value="Update" action="#{carrierBean.saveParty()}" update=":form:tabs:editParty"
							rendered="#{not empty carrierBean.partyModel.entity.id and carrierBean.isAuthorizedResource('UPDATE',carrierBean.partyModel.entity)}" />
						<p:commandButton value="Save" action="#{carrierBean.saveNewParty()}" update=":form:tabs:editParty"
							rendered="#{empty carrierBean.partyModel.entity.id and carrierBean.isAuthorized('CREATE',carrierBean.partyModel.entity.class.name)}" />
					</h:panelGroup>
				</p:tab>

				<p:tab title="Contacts (one2many)" disabled="#{empty carrierBean.selectedCarrierModel.entity.id}" id="contactTab">
					<h:panelGroup id="editContact">
						<p:commandButton value="New" action="#{carrierBean.newContact()}" update=":form:tabs:editContact"
							rendered="#{carrierBean.isAuthorized('CREATE', carrierBean.selectedContactModel.entity.class.name)  and carrierBean.isAuthorizedResource('ADD', carrierBean.selectedCarrierModel.entity, 'contacts')}" />
						<br />
						<my:inputField fieldValue="#{carrierBean.selectedContactModel.entity.contactField}" fieldLabel="Field"
							selectedModel="#{carrierBean.selectedContactModel}" fieldName="contactField"
							fieldModel="#{carrierBean.selectedContactModel.fields.get('contactField')}" />
						<br />
						<p:commandButton value="Update" action="#{carrierBean.saveContact()}" update=":form:tabs:contacts"
							rendered="#{not empty carrierBean.selectedContactModel.entity.id and carrierBean.isAuthorizedResource('UPDATE', carrierBean.selectedContactModel.entity)}" />
						<p:commandButton value="Save" action="#{carrierBean.saveNewContact()}"
							update=":form:tabs:contacts, :form:tabs:editContact"
							rendered="#{empty carrierBean.selectedContactModel.entity.id and carrierBean.isAuthorized('CREATE', carrierBean.selectedContactModel.entity.class.name) and carrierBean.isAuthorizedResource('ADD', carrierBean.selectedCarrierModel.entity, 'contacts')}" />

					</h:panelGroup>

					<h:panelGroup id="contacts">
						<p:dataTable value="#{carrierBean.contacts}" var="contact">
							<p:column>
								<f:facet name="header">
									<h:outputText value="Select" />
								</f:facet>
								<h:selectBooleanCheckbox value="#{contact.selected}"
									rendered="#{carrierBean.isAuthorizedResource('GRANT', contact.entity)}" />
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="Contact field" />
								</f:facet>
								<h:outputText value="#{contact.entity.contactField}" rendered="#{carrierBean.isAuthorizedResource('READ', contact.entity, 'contactField')}"/>
							</p:column>
							<p:column>
								<p:commandButton value="Select" action="#{carrierBean.selectContact(contact.entity)}" update=":form:tabs:editContact" rendered="#{carrierBean.isAuthorizedResource('READ', contact.entity)}"/>
								<p:commandButton value="Delete" action="#{carrierBean.deleteContact(contact.entity)}"
									update=":form:tabs:editContact, :form:tabs:contacts"
									rendered="#{carrierBean.isAuthorizedResource('DELETE', contact.entity) and carrierBean.isAuthorizedResource('REMOVE', carrierBean.selectedCarrierModel.entity, 'contacts')}" />
							</p:column>
						</p:dataTable>
					</h:panelGroup>
				</p:tab>

			</p:tabView>

			<h:panelGroup id="actions">
				<p:selectCheckboxMenu label="Select actions" filter="true" filterText="Filter" filterMatchMode="startsWith"
					panelStyle="width:220px" valueChangeListener="#{carrierBean.selectAction}"
					rendered="#{securityBaseBean.isAuthorized('GRANT', carrierBean.tabEntityClass.name) or securityBaseBean.isAuthorized('REVOKE', carrierBean.tabEntityClass.name)}">
					<f:selectItems value="#{carrierBean.actions}" var="action" itemLabel="#{action.actionName}"
						itemValue="#{action.actionName}" />
				</p:selectCheckboxMenu>

				<br />

				<p:commandButton value="execute" action="#{carrierBean.goToPermissions()}"
					rendered="#{securityBaseBean.isAuthorized('GRANT', carrierBean.tabEntityClass.name) or securityBaseBean.isAuthorized('REVOKE', carrierBean.tabEntityClass.name)}" />
			</h:panelGroup>

		</h:form>
	</h:body>
</f:view>
</html>

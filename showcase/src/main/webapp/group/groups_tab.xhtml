<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui"
	xmlns:my="http://java.sun.com/jsf/composite/components">
<ui:composition>
	<p:tab id="userGroups" title="Groups" disabled="#{empty userSession.selectedUserGroup}">

		<f:event listener="#{groupBean.init}" type="javax.faces.event.PreRenderComponentEvent" />



		<h:panelGrid columns="2" width="100%" columnClasses="top,top" rendered="#{not empty userSession.selectedUserGroup}" style="height:200px">

			<h:panelGroup>
				<h3>
					Selected group: #{userSession.selectedUserGroup.name}
					<p:commandButton action="#{groupBean.unselectGroup}" update=":form:tab" value="X"
						rendered="#{not empty userSession.selectedUserGroup}" process="@this"/>
				</h3>
				<p:dataTable value="#{groupBean.users}" var="user">
					<f:facet name="header">Users of #{userSession.selectedUserGroup.name}</f:facet>
					<p:column>
						<f:facet name="header"> Username</f:facet>
                            #{user.username}
                    </p:column>
				</p:dataTable>

				<h:inputText value="#{groupBean.newGroupName}" />
				<p:commandButton value="Save" action="#{groupBean.saveGroup}" update=":form:tab:groupTree" />
			</h:panelGroup>

			<my:permissionTree id="groupPermissionTableComp" bean="#{groupBean}" tableId="groups_userPermissions" />
		</h:panelGrid>

		<h:panelGroup id="groupTree">
			<p:treeTable value="#{groupBean.groupRoot}" var="group" selectionMode="single"
				selection="#{groupBean.selectedGroupTreeNode}">
				<p:ajax event="select" update=":form:tab" partialSubmit="true"/>
				<p:column>
					<f:facet name="header">Group name</f:facet>
					<h:outputText value="#{group.name}" />
				</p:column>
				<p:column>
					<f:facet name="header">Action</f:facet>
					<p:commandButton value="Delete" />
				</p:column>
			</p:treeTable>
		</h:panelGroup>
	</p:tab>


</ui:composition>
</html>